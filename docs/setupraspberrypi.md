# Setup Raspberry Pi

## Flash OS

Donwload img: https://www.raspberrypi.org/downloads/raspberry-pi-os/
Choose Lite 

Flash with for instance:
https://www.balena.io/etcher/ 


## Add SSH Access and Wifi 

For headless operation:
https://www.raspberrypi.org/documentation/configuration/wireless/headless.md 
- Enable SSH 
  - Put file with name "ssh" without extension in root folder of boot partition
- (optional) Enable Wifi otherwise use Ethernet connection
  - Put "wpa_supplicant.conf" file in root folder

Content of wpa_supplicant.conf
adapt countrycode, ssid and psk:
```
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=<Insert 2 letter ISO 3166-1 country code here e.g. DE> 

network={
    ssid="<Name of your wireless LAN>"
    psk="<Password for your wireless LAN>"
}
```

## On first boot
- change password with 
  - ```passwd```
- update upgrade
  - ````sudo apt update && sudo apt -y upgrade````

## passwordless SSH
add your public ssh key to ~/.ssh/authorized_keys (on the pi) for passwordless ssh connection

### (optional) generate SSH key
https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent

To avoid hassle leave password of the key blank

### Copy public key
Adapt to match your file / key names / domain names

On Linux:
```
cat ~/.ssh/id_rsa.pub | ssh pi@raspberrypi 'mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys'
```

On Windows:
```
type %USERPROFILE%\\.ssh\\id_rsa.pub | ssh  pi@raspberrypi "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

## (optional) create ssh key on pi and connect it with github

https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh

## Activate Interfaces

```
sudo raspi-config
```
enable camera Interface, (optional)serial-interface


## Install [[nodejs]]

```
curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -
```

use correct version number: 14 is current as of 2020-08-28

```
sudo apt install -y nodejs
```

## Get Project from Github
```
git clone https://github.com/Ch3ri0ur/pirate.git
cd pirate
npm install pirate
npm run start             # For Development
npm run build             # For Production
```

(optional) if Arduino is flashed from Raspberry Pi
```
 git clone https://github.com/Ch3ri0ur/pirate_modules.git
```

docker run -d --restart always --name restreamer -e "RS_USERNAME=fn" -e "RS_PASSWORD=asdfasdf" -e "RS_MODE=RASPICAM" -p 8080:8080 -v /mnt/restreamer/db:/restreamer/db -v /opt/vc:/opt/vc --privileged datarhei/restreamer-armv7l:latest
major delay

[//begin]: # "Autogenerated link references for markdown compatibility"
[nodejs]: nodejs "Nodejs"
[//end]: # "Autogenerated link references"