# Implementation
The flag is a website written in [[React]] a library for creating dynamic websites. This [[React]] client is based on a [[CRA]] template for [[Typescript]]. A React project is structured into components which can be placed into each other. This helps encapsulating the different tasks. These components can communicate with their children by passing variables called properties and their parents by passing callbacks as properties a method called "hoisting". With only these methods it would be quite tedious to pass variables to a neighboring component branch, requiring hoisting and subsequent "prop drilling" a pattern in which properties are passed on from child to child in order to reach the destination. To streamline this process it is possible to use either a state management library or implement this functionality. In this project the library [react-hookstore](https://github.com/jhonnymichel/react-hookstore) was used which is based on Reacts useState-hook. 

!!! note "useState"
    The useState-hook is a new state management method in React. When calling ```[state,setState] = useState(initialValue)``` the value and a setState function are created. If this function is called the component in which the useState was used is notified of the new state and rerenders.

With this library the same "useState" hook can be used in multiple components without needing to pipe the values through the parents. 

On creation of the Website the 
The website is structured into:

* Header
* Content
* Footer

Both Header and Footer are static. The functionality of the client stems from the content component. It has 4 major sub components:

* The graph to display the current data
* The sliders to control the Arduino
* a settings modal 
* and a live view of the project.

## Graph

On the top the whole width is spanned by the most important feature of the client: the graph displaying the current information from the Arduino project. The draw the graph a library called [uplot](https://github.com/leeoniya/uPlot) is used. This library was chosen, because it is a no frills, small bundle size, fast draw time ([benchmarks](https://github.com/leeoniya/uPlot#Performance)) kind of library. An alternative would have been a webGL based chart renderer, utilizing the GPU, but they are bigger, slower to start, harder to integrate and not as fully featured.

This component itself also has a set of tasks:

### Sourcing the data

When this component is created or when the configuration changes  when the config options from the change

Instead of a centralized component sourcing all the necessary data for all components, here the graph component itself registers for the SSE-Stream on "/stream". 
    generate dynamic data structure based on config
    Strings/char not implemented.
put in queue
on animation frame 
render new data 
    smooth by rendering a dynamic amount
check for options change
pause
    stop refresh 
    rolling update in background
export
    transpose
    generate csv
resize listener


## Sliders

depending on config 
list of control surfaces
    only number sliders implemented 
    strings/char still missing
on change post to bridge endpoint add uuid
listen to other changes and compare uuid
    individual sliders register a update function in the sliderlist component that checks the updates


dynamic for different screen sizes


## Settings

debug messages not yet implemented.
dynamic show/no show checklist
number input for max timestamps

## Live View

Modified janus.js from github
removed old optional dependencies
added webrtc adapter
export module

view create 
build on the janus stream client demo
removed jquery
autostart session
currently no good session handling

problems with complex nat traversal 

[//begin]: # "Autogenerated link references for markdown compatibility"
[React]: Theory\react "React"
[CRA]: Theory\cra "CRA"
[//end]: # "Autogenerated link references"