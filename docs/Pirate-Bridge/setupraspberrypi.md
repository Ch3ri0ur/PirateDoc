# Setup Raspberry Pi

1. **[Install Raspberry Pi OS](#install)**
   - Any version of Raspbian OS will probably work.
   - For max. performance a none Desktop version should be used.
2. **[Basic Configuration Raspberry Pi](#config)**
   - Change default Password
   - Activate SSH
   - Activate WiFi (optional)
   - Perform Update & upgrade
3. **[Setup Raspberry Pi for PirAtE](#setup)**
   - Activate RPi Camera Interface
   - Activate Serial Interface
   - Install Git
   - Install [Nodejs]
   - Install [Docker]

More detailed setup instructions for a Raspberry Pi Desktop can be found here:
https://projects.raspberrypi.org/en/projects/raspberry-pi-setting-up

## 1. Install Raspberry Pi OS on an SD Card<a id="install"></a>
The Installation can be done in two ways.
- Using the official Installer from Raspberry Pi
- Using another Imager and download the Image manually

Both methods are shown on the Raspberry Pi Homepage
https://www.raspberrypi.org/documentation/installation/installing-images/README.md


### Using Downloader and Installer from Raspberry Pi

Raspberry Pi Imager can be downloaded from the Raspberry Homepage.
https://www.raspberrypi.org/downloads/ \
After Starting the Imager it will let you select 


### Download Image from Raspberry Pi homepage and using an Imager to install it

Prepare SD Card
SD Card Formater
https://www.sdcard.org/downloads/formatter/

Download Image
Raspberry Pi OS (32-bit) Lite
from https://www.raspberrypi.org/downloads/raspberry-pi-os/

Flash OS
https://www.balena.io/etcher/ 
https://win32diskimager.download/



## Configure Pi<a id="config"></a>
### For remote Access, SSH and WiFi should be activated before starting
https://www.raspberrypi.org/documentation/configuration/wireless/headless.md 

For the Full Headless mode (no attached Screen)\
The SSH (and WiFi) need to be Setup before the First boot
- Enable SSH 
  - Put file with name "ssh" without extension in root folder of boot partition
   https://www.elektronik-kompendium.de/sites/raspberry-pi/1906281.htm
- Enable Wifi otherwise use Ethernet connection
  - Put "wpa_supplicant.conf" file in root folder\
   Content of wpa_supplicant.conf
   adapt countrycode, ssid and psk:
   ```
   ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
   update_config=1
   country=<Insert 2 letter ISO 3166-1 country code here e.g. DE> 

   network={
       ssid="<Name of your wireless LAN>"
       psk="<Password for your wireless LAN>"
   }
   ```
   Replace all ```<...>``` !



## 2. Basic Configuration Raspberry Pi
- change password with 
  - ```passwd```
- update upgrade
  - ```sudo apt update && sudo apt -y upgrade```
- When not done before
  - activate ssh
  - activate wifi
  - expand file system (optional, needed in old Pi Versions)

https://www.elektronik-kompendium.de/sites/raspberry-pi/1906291.htm


## 3. Setup Raspberry Pi for PirAtE<a id="setup"></a>
### Activate Interfaces

```
sudo raspi-config
```
enable camera Interface, (optional)serial-interface

```
sudo apt install git -y
```
[[docker]]



## Install [[nodejs]]

```
curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -
```

use correct version number: 14 is current as of 2020-08-28

```
sudo apt install -y nodejs
```



## Get Project from Github
```
git clone https://github.com/Ch3ri0ur/pirate.git
cd pirate
npm install pirate
npm run start             # For Development
npm run build             # For Production
```

if Arduino is flashed from Raspberry Pi
```
 git clone https://github.com/Ch3ri0ur/pirate_modules.git
```
 cd pirate_modules/janus-gateway-docker/

 docker-compose up


docker run -d --restart always --name restreamer -e "RS_USERNAME=fn" -e "RS_PASSWORD=asdfasdf" -e "RS_MODE=RASPICAM" -p 8080:8080 -v /mnt/restreamer/db:/restreamer/db -v /opt/vc:/opt/vc --privileged datarhei/restreamer-armv7l:latest
major delay







## passwordless SSH
add your public ssh key to ~/.ssh/authorized_keys (on the pi) for passwordless ssh connection

### (optional) generate SSH key
https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent

To avoid hassle leave password of the key blank

### Copy public key
Adapt to match your file / key names / domain names

On Linux:
```
cat ~/.ssh/id_rsa.pub | ssh pi@raspberrypi 'mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys'
```

On Windows:
```
type %USERPROFILE%\\.ssh\\id_rsa.pub | ssh  pi@raspberrypi "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

## (optional) create ssh key on pi and connect it with github

https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh



[//begin]: # "Autogenerated link references for markdown compatibility"
[docker]: docker "Docker"
[nodejs]: nodejs "Nodejs"
[//end]: # "Autogenerated link references"